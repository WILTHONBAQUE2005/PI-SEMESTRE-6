@model SwimRoomWeb.Models.ClienteDetalleViewModel

@{
    ViewData["Title"] = "Detalle de cliente";
}

<div class="mb-3">
    <a asp-action="Index" class="btn btn-sm btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Volver a clientes
    </a>
</div>

<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
                <h5 class="card-title mb-1">@Model.NombreCompleto</h5>
                <div class="text-muted small mb-2">Cédula: @Model.Cedula</div>
                <span class="badge
                    @(Model.RiesgoMaximo == "ALTO" ? "bg-danger" :
                      Model.RiesgoMaximo == "MEDIO" ? "bg-warning text-dark" :
                      "bg-success")">
                    Riesgo @Model.RiesgoMaximo
                </span>
                <div class="mt-3 small text-muted">
                    Última evaluación: @Model.UltimaFechaRegistro.ToString("g")
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-8 mb-3">
        <div class="row h-100 g-3">
            <div class="col-md-4">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body py-3">
                        <div class="text-muted small">Total ventas</div>
                        <div class="fs-4 fw-bold">@Model.TotalVentas</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body py-3">
                        <div class="text-muted small">Monto total</div>
                        <div class="fs-4 fw-bold">@Model.MontoTotal.ToString("N2")</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body py-3">
                        <div class="text-muted small">Prob. mora prom.</div>
                        <div class="fs-4 fw-bold">@Model.ProbMoraPromedio.ToString("P2") %</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-body">
        <h5 class="card-title mb-3">Historial de ventas diferidas</h5>

        <div class="table-responsive">
            <table class="table table-hover align-middle" id="tablaClientesVentas">
                <thead class="table-light">
                    <tr>
                        <th>Monto</th>
                        <th>Cuotas</th>
                        <th>Ingreso mensual</th>
                        <th>Días atraso máx.</th>
                        <th>% cuotas pagadas</th>
                        <th>Riesgo</th>
                        <th>Prob. mora</th>
                        <th>Fecha registro</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var v in Model.Ventas)
                {
                    var riesgoLower = v.NivelRiesgo.ToLower();
                    <tr data-riesgo="@riesgoLower">
                        <td>@v.MontoCompra.ToString("N2")</td>
                        <td>@v.NumCuotas</td>
                        <td>@v.IngresoMensual.ToString("N2")</td>
                        <td>@v.DiasAtrasoMax</td>
                        <td>@v.PorcentajeCuotasPagadas.ToString("N0") %</td>
                        <td>
                            <span class="badge
                                @(v.NivelRiesgo.ToUpper() == "ALTO" ? "bg-danger" :
                                  v.NivelRiesgo.ToUpper() == "MEDIO" ? "bg-warning text-dark" :
                                  "bg-success")">
                                @v.NivelRiesgo.ToUpper()
                            </span>
                        </td>
                        <td>@v.ProbabilidadMora.ToString("P2")</td>
                        <td>@v.FechaRegistro.ToString("g")</td>
                    </tr>
                }
                </tbody>
            </table>
        </div>

    </div>
</div>
